<div class="container mt-4">
  <h3 class="text-center mb-4">Gestión de artículos solidarios</h3>

  <!-- Formulario -->
  <div class="card p-4 mb-4">
    <h5 class="mb-3">{{ modoEdicion ? 'Editar artículo' : 'Nuevo artículo' }}</h5>

    <form #form="ngForm" (ngSubmit)="guardarArticulo(form)" novalidate>
      <div class="row g-3">

        <!-- Nombre -->
        <div class="col-md-6">
          <label class="form-label">Nombre</label>
          <input type="text" class="form-control" name="nombre" [(ngModel)]="nuevoArticulo.nombre" required minlength="4" #nombre="ngModel">
          @if (nombre.invalid && nombre.touched) {
            <div class="text-danger small">
              El nombre es obligatorio y debe tener al menos 4 caracteres.
            </div>
          }
        </div>

        <!-- Precio -->
        <div class="col-md-6">
          <label class="form-label">Precio</label>
          <input type="text" class="form-control" name="precio" [(ngModel)]="nuevoArticulo.precio" required #precio="ngModel">
          @if (precio.invalid && precio.touched) {
            <div class="text-danger small">
              El precio es obligatorio.
            </div>
          }
        </div>

        <!-- Descripción -->
        <div class="col-md-12">
          <label class="form-label">Descripción</label>
          <textarea class="form-control" name="descripcion" [(ngModel)]="nuevoArticulo.descripcion" rows="3" minlength="10" #descripcion="ngModel"></textarea>
          @if (descripcion.invalid && descripcion.touched) {
            <div class="text-danger small">
              La descripción debe tener al menos 10 caracteres.
            </div>
          }
        </div>

        <!-- Imagen -->
        <div class="col-md-12">
          <label class="form-label">URL de imagen</label>
          <input type="url" class="form-control" name="imagen" [(ngModel)]="nuevoArticulo.imagen" pattern="https?://.+" #imagen="ngModel">
          @if (imagen.invalid && imagen.touched) {
            <div class="text-danger small">
              Introduce una URL válida que empiece por http:// o https://
            </div>
          }
        </div>

        <!-- Referencia -->
        <div class="col-md-6">
          <label class="form-label">Referencia</label>
          <input type="text" class="form-control" name="referencia" [(ngModel)]="nuevoArticulo.referencia" required #referencia="ngModel">
          @if (referencia.invalid && referencia.touched) {
            <div class="text-danger small">
              La referencia es obligatoria.
            </div>
          }
        </div>

        <!-- Botones -->
        <div class="text-center mt-3">
          <button type="submit" class="btn custom-btn me-2" [disabled]="form.invalid">
            {{ modoEdicion ? 'Actualizar' : 'Guardar artículo' }}
          </button>
          @if (modoEdicion) {
            <button type="button" class="btn btn-secondary" (click)="cancelarEdicion(form)">
              Cancelar
            </button>
          }
        </div>
      </div>
    </form>
  </div>

  <!-- Lista de artículos -->
  <div class="row g-4">
    @for (articulo of articulos; track articulo._id) {
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <img [src]="articulo.imagen | imageUrl" class="card-img-top" [alt]="articulo.nombre">
          <div class="card-body">
            <h5 class="card-title">{{ articulo.nombre }}</h5>
            <p>{{ articulo.descripcion }}</p>
            <p><strong>Precio:</strong> {{ articulo.precio }}</p>
            <p><strong>Ref:</strong> {{ articulo.referencia }}</p>

            <div class="card-buttons mt-auto text-center">
              <button class="btn custom-edit-btn me-2" (click)="editarArticulo(articulo)">Editar</button>
              <button class="btn custom-delete-btn" (click)="eliminarArticulo(articulo._id)">Eliminar</button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Toast de confirmación -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          Artículo guardado correctamente.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
      </div>
    </div>
  </div>
</div>
