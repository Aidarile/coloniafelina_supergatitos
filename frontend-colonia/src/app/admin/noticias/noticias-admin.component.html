<div class="container mt-4">
  <h3 class="text-center mb-4">Gestión de noticias</h3>

  <!-- Formulario -->
  <div class="card p-4 mb-4">
    <h5>{{ modoEdicion ? 'Editar noticia' : 'Añadir nueva noticia' }}</h5>

    <form #form="ngForm" (ngSubmit)="guardarNoticia(form)" novalidate>
      <div class="row g-3">

        <!-- Título -->
        <div class="col-md-12">
          <label class="form-label">Título</label>
          <input type="text" class="form-control" [(ngModel)]="nuevaNoticia.titulo" name="titulo" required minlength="5" #titulo="ngModel">
          @if (titulo.invalid && titulo.touched) {
            <div class="text-danger small">
              El título es obligatorio y debe tener al menos 5 caracteres.
            </div>
          }
        </div>

        <!-- Contenido -->
        <div class="col-md-12">
          <label class="form-label">Contenido</label>
          <textarea class="form-control" name="contenido" [(ngModel)]="nuevaNoticia.contenido" rows="5" required minlength="10" #contenido="ngModel"></textarea>
          @if (contenido.invalid && contenido.touched) {
            <div class="text-danger small">
              El contenido debe tener al menos 10 caracteres.
            </div>
          }
        </div>

        <!-- Imagen -->
        <div class="col-md-12">
          <label class="form-label">URL de imagen (opcional)</label>
          <input type="url" class="form-control" name="imagen" [(ngModel)]="nuevaNoticia.imagen" pattern="https?://.+" #imagen="ngModel" />
          @if (imagen.invalid && imagen.touched) {
            <div class="text-danger small">
              Introduce una URL válida que empiece por http:// o https://
            </div>
          }
        </div>

        <!-- Autor -->
        <div class="col-md-6">
          <label class="form-label">Autor (opcional)</label>
          <input type="text" class="form-control" name="autor" [(ngModel)]="nuevaNoticia.autor">
        </div>

        <!-- Tags -->
        <div class="col-md-6">
          <label class="form-label">Tags (separados por comas)</label>
          <input type="text" class="form-control" name="tags" [(ngModel)]="nuevaNoticia.tags">
        </div>

        <!-- Botones -->
        <div class="text-center mt-3">
          <button type="submit" [disabled]="form.invalid" class="btn custom-btn me-2">
            {{ modoEdicion ? 'Actualizar noticia' : 'Guardar noticia' }}
          </button>
          @if (modoEdicion) {
            <button type="button" class="btn btn-secondary" (click)="cancelarEdicion(form)">
              Cancelar
            </button>
          }
        </div>

      </div>
    </form>
  </div>

  <!-- Lista de noticias paginada -->
  <div class="row g-4">
    @for (noticia of noticiasPaginadas(); track noticia._id) {
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          @if (noticia.imagen) {
            <img [src]="noticia.imagen" class="card-img-top" [alt]="noticia.titulo">
          }
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ noticia.titulo }}</h5>
            <p class="noticia-contenido" [innerHTML]="noticia.contenido"></p>
            @if (noticia.autor) {
              <p><strong>Autor:</strong> {{ noticia.autor }}</p>
            }
            @if (noticia.tags) {
              <p><strong>Tags:</strong> {{ noticia.tags }}</p>
            }

            <div class="card-buttons mt-auto text-center">
              <button class="btn custom-edit-btn me-2" (click)="editarNoticia(noticia)">Editar</button>
              <button class="btn custom-delete-btn" (click)="eliminarNoticia(noticia._id)">Eliminar</button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Paginación -->
  @if (totalPaginas().length > 1) {
  <div class="d-flex justify-content-center mt-4 gap-3">
    <button class="btn paginacion-btn" [disabled]="paginaActual === 1" (click)="cambiarPagina(paginaActual - 1)">
      <i class="bi bi-chevron-left"></i>
    </button>
    <span class="align-self-center">Página {{ paginaActual }} de {{ totalPaginas().length }}</span>
    <button class="btn paginacion-btn" [disabled]="paginaActual === totalPaginas().length" (click)="cambiarPagina(paginaActual + 1)">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
}

  <!-- Toast de confirmación de éxito -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          Noticia guardada correctamente.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
      </div>
    </div>
  </div>
</div>
